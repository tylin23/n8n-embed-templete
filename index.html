<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n-fb-post-with-img</title>
    <script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.0.0/webcomponents-loader.js"></script>
<script src="https://www.unpkg.com/lit@2.0.0-rc.2/polyfill-support.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@n8n_io/n8n-demo-component/n8n-demo.bundled.js"></script>
</head>
<body>
    <div>
    <n8n-demo workflow='{
        "nodes": [
          {
            "parameters": {
              "pollTimes": {
                "item": [
                  {
                    "mode": "everyX",
                    "value": 15,
                    "unit": "minutes"
                  }
                ]
              },
              "documentId": {
                "__rl": true,
                "value": "XXX",
                "mode": "list",
                "cachedResultName": "社群發文排程",
                "cachedResultUrl": "XXX"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "facebook",
                "cachedResultUrl": "XXX"
              },
              "event": "rowAdded",
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheetsTrigger",
            "typeVersion": 1,
            "position": [
              -300,
              -60
            ],
            "id": "XXX",
            "name": "Google Sheets 偵測新資料",
            "credentials": {
              "googleSheetsTriggerOAuth2Api": {
                "id": "XXX",
                "name": "Google Sheets Trigger account"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "XXX",
                    "leftValue": "={{$json['發文時間'].replace(' ', 'T')}}",
                    "rightValue": "={{ $now }}",
                    "operator": {
                      "type": "dateTime",
                      "operation": "beforeOrEquals"
                    }
                  },
                  {
                    "id": "XXX",
                    "leftValue": "={{ $json['狀態'] }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "looseTypeValidation": true,
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              -40,
              -60
            ],
            "id": "XXX",
            "name": "If 判斷是否到了發文排程時間＆尚未上架"
          },
          {
            "parameters": {
              "resource": "image",
              "prompt": "={{ $json['做圖提示詞'] }}",
              "options": {
                "quality": "standard",
                "size": "1024x1024",
                "style": "vivid"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 1.8,
            "position": [
              240,
              -180
            ],
            "id": "XXX",
            "name": "OpenAI 依照提示詞作圖",
            "credentials": {
              "openAiApi": {
                "id": "XXX",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "operation": "upload",
              "path": "/tingyu/Social media/fb_post_img.png"
            },
            "type": "n8n-nodes-base.ftp",
            "typeVersion": 1,
            "position": [
              460,
              -180
            ],
            "id": "XXX",
            "name": "FTP 上傳圖片備份",
            "credentials": {
              "ftp": {
                "id": "XXX",
                "name": "FTP account"
              }
            }
          },
          {
            "parameters": {
              "path": "/tingyu/Social media/fb_post_img.png",
              "binaryPropertyName": "data-img"
            },
            "type": "n8n-nodes-base.ftp",
            "typeVersion": 1,
            "position": [
              680,
              -180
            ],
            "id": "XXX",
            "name": "FTP 下載給發文用",
            "credentials": {
              "ftp": {
                "id": "XXX",
                "name": "FTP account"
              }
            }
          },
          {
            "parameters": {
              "mode": "combine",
              "combineBy": "combineByPosition",
              "options": {}
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.1,
            "position": [
              460,
              100
            ],
            "id": "XXX",
            "name": "Merge 合併圖與文"
          },
          {
            "parameters": {
              "httpRequestMethod": "POST",
              "graphApiVersion": "v22.0",
              "node": "me",
              "edge": "photos",
              "sendBinaryData": true,
              "binaryPropertyName": "data-img",
              "options": {
                "queryParameters": {
                  "parameter": [
                    {
                      "name": "message",
                      "value": "={{ $json['發文內容'] }}"
                    }
                  ]
                }
              }
            },
            "type": "n8n-nodes-base.facebookGraphApi",
            "typeVersion": 1,
            "position": [
              680,
              100
            ],
            "id": "XXX",
            "name": "Facebook 粉專發布新貼文",
            "credentials": {
              "facebookGraphApi": {
                "id": "XXX",
                "name": "Facebook Graph account"
              }
            }
          },
          {
            "parameters": {
              "operation": "update",
              "documentId": {
                "__rl": true,
                "value": "XXX",
                "mode": "list",
                "cachedResultName": "社群發文排程",
                "cachedResultUrl": "XXX"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "facebook",
                "cachedResultUrl": "XXX"
              },
              "columns": {
                "mappingMode": "defineBelow",
                "value": {
                  "狀態": "貼文已上架",
                  "發文時間": "={{ DateTime.fromISO($now, { setZone: true }).toFormat(\"yyyy-MM-dd HH:mm\") }}",
                  "發文內容": "={{ $('If 判斷是否到了發文排程時間＆尚未上架').item.json['發文內容'] }}",
                  "做圖提示詞": "={{ $('If 判斷是否到了發文排程時間＆尚未上架').item.json['做圖提示詞'] }}"
                },
                "matchingColumns": [
                  "發文內容"
                ],
                "schema": [
                  {
                    "id": "發文內容",
                    "displayName": "發文內容",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true,
                    "removed": false
                  },
                  {
                    "id": "做圖提示詞",
                    "displayName": "做圖提示詞",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "發文時間",
                    "displayName": "發文時間",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "狀態",
                    "displayName": "狀態",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "2025/4/3 上午 2:39:09",
                    "displayName": "2025/4/3 上午 2:39:09",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "row_number",
                    "displayName": "row_number",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true,
                    "readOnly": true,
                    "removed": true
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheets",
            "typeVersion": 4.5,
            "position": [
              900,
              100
            ],
            "id": "XXX",
            "name": "Google Sheets 更新發文時間與狀態",
            "credentials": {
              "googleSheetsOAuth2Api": {
                "id": "XXX",
                "name": "Google Sheets account"
              }
            }
          },
          {
            "parameters": {
              "authentication": "webhook",
              "content": "=粉絲專頁有新發文囉！\n內容：{{ $('Merge 合併圖與文').item.json['發文內容'] }}\n發文時間：{{ DateTime.fromISO($now, { setZone: true }).toFormat(\"yyyy-MM-dd HH:mm\") }}",
              "options": {}
            },
            "type": "n8n-nodes-base.discord",
            "typeVersion": 2,
            "position": [
              1120,
              100
            ],
            "id": "XXX",
            "name": "Discord 到頻道發送上架貼文的通知",
            "webhookId": "XXX",
            "credentials": {
              "discordWebhookApi": {
                "id": "XXX",
                "name": "Discord Webhook account"
              }
            }
          },
          {
            "parameters": {
              "content": "## 產生發文圖片 \n利用 **OpenAI API** 生成圖片",
              "height": 280,
              "width": 660,
              "color": 5
            },
            "type": "n8n-nodes-base.stickyNote",
            "position": [
              180,
              -300
            ],
            "typeVersion": 1,
            "id": "XXX",
            "name": "Sticky Note"
          }
        ],
        "connections": {
          "Google Sheets 偵測新資料": {
            "main": [
              [
                {
                  "node": "If 判斷是否到了發文排程時間＆尚未上架",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "If 判斷是否到了發文排程時間＆尚未上架": {
            "main": [
              [
                {
                  "node": "OpenAI 依照提示詞作圖",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Merge 合併圖與文",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "OpenAI 依照提示詞作圖": {
            "main": [
              [
                {
                  "node": "FTP 上傳圖片備份",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "FTP 上傳圖片備份": {
            "main": [
              [
                {
                  "node": "FTP 下載給發文用",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "FTP 下載給發文用": {
            "main": [
              [
                {
                  "node": "Merge 合併圖與文",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Merge 合併圖與文": {
            "main": [
              [
                {
                  "node": "Facebook 粉專發布新貼文",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Facebook 粉專發布新貼文": {
            "main": [
              [
                {
                  "node": "Google Sheets 更新發文時間與狀態",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Google Sheets 更新發文時間與狀態": {
            "main": [
              [
                {
                  "node": "Discord 到頻道發送上架貼文的通知",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "pinData": {},
        "meta": {
          "templateCredsSetupCompleted": true,
          "instanceId": "XXX"
        }
      }'></n8n-demo>
    </div>
</body>
</html>
